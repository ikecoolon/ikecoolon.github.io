<div id="analysis-rules" class="page p-4">
    <!-- 主列表视图 -->
    <div id="main-view" class="bg-white p-6 rounded-lg shadow-md">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold">分析建议规则管理</h3>
            <button id="add-new-rule" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600">
                <i class="fas fa-plus mr-2"></i>新增规则
            </button>
        </div>
        
        <div class="flex flex-col md:flex-row gap-4 mb-4">
            <div class="flex-1">
                <input type="text" id="search-rule" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="搜索规则名称、条件、建议内容">
            </div>
            <div class="flex space-x-2">
                <select id="filter-status" class="shadow border rounded py-2 px-3 text-gray-700 focus:outline-none focus:shadow-outline">
                    <option value="">全部状态</option>
                    <option value="active">启用中</option>
                    <option value="inactive">已停用</option>
                </select>
                <select id="filter-type" class="shadow border rounded py-2 px-3 text-gray-700 focus:outline-none focus:shadow-outline">
                    <option value="">全部类型</option>
                    <option value="analysis">分析内容</option>
                    <option value="advice">建议内容</option>
                    <option value="both">分析+建议</option>
                </select>
            </div>
        </div>
        
        <div class="overflow-x-auto">
            <table class="min-w-full bg-white border border-gray-200 table-fixed">
                <colgroup>
                    <col class="w-1/6"> <!-- 规则信息 -->
                    <col class="w-1/4"> <!-- 触发条件 -->
                    <col class="w-1/6"> <!-- 分析内容 -->
                    <col class="w-1/6"> <!-- 建议内容 -->
                    <col class="w-16">  <!-- 状态 -->
                    <col class="w-16">  <!-- 更新时间 -->
                    <col class="w-24">  <!-- 操作 -->
                </colgroup>
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">规则信息</th>
                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">触发条件</th>
                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分析内容</th>
                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">建议内容</th>
                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">状态</th>
                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">更新</th>
                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                    </tr>
                </thead>
                <tbody id="rules-table-body" class="bg-white divide-y divide-gray-200">
                    <tr>
                        <td colspan="7" class="px-6 py-4 text-center text-gray-500">暂无规则配置</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Tooltip 容器 -->
        <div id="content-tooltip" class="absolute z-50 hidden bg-white text-gray-800 text-xs rounded px-3 py-2 max-w-md shadow-xl border border-gray-200">
            <div id="tooltip-content" class="break-words"></div>
            <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"></div>
        </div>
    </div>
    

    
    <!-- 新增/编辑视图 -->
    <div id="form-view" class="bg-white p-6 rounded-lg shadow-md hidden">
        <div class="flex justify-between items-center mb-4">
            <h3 id="form-title" class="text-xl font-semibold">新增分析规则</h3>
            <button id="back-to-list" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">
                <i class="fas fa-arrow-left mr-2"></i>返回列表
            </button>
        </div>
        
        <form id="rule-form" class="space-y-6">
            <!-- 基本信息 -->
            <div class="bg-gray-50 p-4 rounded-lg">
                <h4 class="text-lg font-medium mb-4 text-gray-800">基本信息</h4>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="form-rule-name">
                            规则名称 <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="form-rule-name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="请输入规则名称" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="form-rule-description">
                            规则描述
                        </label>
                        <textarea id="form-rule-description" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" rows="2" placeholder="请描述此规则的用途和应用场景"></textarea>
                    </div>
                </div>
            </div>

            <!-- 触发条件配置 -->
            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-lg font-medium text-gray-800">触发条件配置</h4>
                    <div class="flex space-x-2">
                        <select id="logic-operator" class="text-sm px-3 py-1 border rounded bg-white">
                            <option value="AND">所有条件都满足 (且)</option>
                            <option value="OR">任一条件满足 (或)</option>
                        </select>
                        <button type="button" id="add-condition-btn" class="text-sm px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">
                            <i class="fas fa-plus mr-1"></i>添加条件
                        </button>
                    </div>
                </div>
                
                <div id="conditions-container" class="space-y-3">
                    <!-- 条件将在这里动态添加 -->
                </div>
                
                <div id="no-conditions" class="text-center py-8 text-gray-500">
                    <i class="fas fa-plus-circle text-4xl mb-4 text-gray-400"></i>
                    <p>还没有配置触发条件</p>
                    <p class="text-sm">点击"添加条件"开始配置规则</p>
                </div>
            </div>

            <!-- 输出内容 -->
            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                <h4 class="text-lg font-medium mb-4 text-gray-800">输出内容</h4>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="form-analysis-content">
                            分析内容
                        </label>
                        <textarea id="form-analysis-content" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" rows="3" placeholder="当条件满足时显示的分析内容，如：检测显示您的宠物肠道菌群失衡"></textarea>
                        <p class="text-xs text-gray-500 mt-1">用于说明检测结果的分析</p>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="form-suggestion-content">
                            建议内容
                        </label>
                        <textarea id="form-suggestion-content" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" rows="3" placeholder="当条件满足时给出的健康建议，如：建议增强维生素的摄入"></textarea>
                        <p class="text-xs text-gray-500 mt-1">用于给出具体的健康建议</p>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="form-output-type">
                            输出类型 <span class="text-red-500">*</span>
                        </label>
                        <select id="form-output-type" class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                            <option value="">请选择输出类型</option>
                            <option value="analysis">仅分析内容</option>
                            <option value="advice">仅建议内容</option>
                            <option value="both">分析+建议内容</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 规则测试 -->
            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                <h4 class="text-lg font-medium mb-4 text-gray-800">规则测试</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <button type="button" id="test-rule-btn" class="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600">
                            <i class="fas fa-vial mr-2"></i>测试规则
                        </button>
                        <p class="text-sm text-gray-600 mt-2">使用示例数据测试当前规则配置是否正确</p>
                    </div>
                    <div id="test-result" class="hidden">
                        <div class="p-3 rounded border">
                            <h5 class="font-medium">测试结果：</h5>
                            <div id="test-result-content" class="mt-2 text-sm"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 其他设置 -->
            <div class="bg-gray-50 p-4 rounded-lg">
                <h4 class="text-lg font-medium mb-4 text-gray-800">其他设置</h4>
                <div class="flex items-center">
                    <input type="checkbox" id="form-rule-active" class="mr-2" checked>
                    <label for="form-rule-active" class="text-sm text-gray-700">启用此规则</label>
                </div>
            </div>
            
            <div class="flex space-x-4">
                <button type="submit" id="save-rule" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">
                    <i class="fas fa-save mr-2"></i>保存规则
                </button>
                <button type="button" id="cancel-form" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">
                    取消
                </button>
            </div>
        </form>
    </div>

    <!-- 条件配置模板 -->
    <template id="condition-template">
        <div class="condition-item p-4 border border-gray-200 rounded-lg bg-white">
            <div class="flex items-center justify-between mb-3">
                <span class="text-sm font-medium text-gray-700">条件 <span class="condition-number">1</span></span>
                <button type="button" class="remove-condition text-red-500 hover:text-red-700">
                    <i class="fas fa-trash text-sm"></i>
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                <div>
                    <label class="block text-xs font-medium text-gray-600 mb-1">检测指标</label>
                    <input type="text" class="condition-indicator w-full px-2 py-1 border rounded text-sm" placeholder="如：放线菌门">
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-600 mb-1">比较符</label>
                    <select class="condition-operator w-full px-2 py-1 border rounded text-sm">
                        <option value=">">大于 (&gt;)</option>
                        <option value=">=">大于等于 (&gt;=)</option>
                        <option value="<">小于 (&lt;)</option>
                        <option value="<=">小于等于 (&lt;=)</option>
                        <option value="=">等于 (=)</option>
                        <option value="!=">不等于 (≠)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-600 mb-1">阈值</label>
                    <input type="number" class="condition-value w-full px-2 py-1 border rounded text-sm" placeholder="50" step="0.01">
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-600 mb-1">单位</label>
                    <input type="text" class="condition-unit w-full px-2 py-1 border rounded text-sm" placeholder="%" value="%">
                </div>
            </div>
        </div>
    </template>

    <!-- 规则测试模态框 -->
    <div id="test-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-6xl h-5/6 flex flex-col">
            <!-- 模态框头部 -->
            <div class="flex items-center justify-between px-6 py-4 border-b border-gray-200 flex-shrink-0">
                <h3 class="text-lg font-semibold text-gray-900">
                    <i class="fas fa-vial mr-2 text-blue-600"></i>测试分析规则
                </h3>
                <button id="close-test-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- 模态框内容区域 -->
            <div class="flex-1 overflow-hidden flex flex-col">
                <!-- 当前规则信息 -->
                <div class="px-6 py-4 bg-blue-50 border-b border-blue-200 flex-shrink-0">
                    <h4 class="text-md font-medium text-blue-900 mb-2">当前测试规则</h4>
                    <div class="space-y-1">
                        <div><strong>规则名称：</strong><span id="rule-name-display" class="text-gray-700"></span></div>
                        <div><strong>触发条件：</strong><span id="rule-conditions-display" class="text-gray-700 text-sm"></span></div>
                    </div>
                </div>
                
                <!-- 搜索筛选区域 -->
                <div class="px-6 py-4 bg-gray-50 border-b border-gray-200 flex-shrink-0">
                    <h4 class="text-md font-medium text-gray-900 mb-3">筛选条件</h4>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">搜索报告</label>
                            <input type="text" id="search-reports" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" placeholder="宠物名、主人、报告编号...">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">健康状态</label>
                            <select id="filter-health-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                                <option value="">全部状态</option>
                                <option value="A">A级-优秀</option>
                                <option value="B">B级-良好</option>
                                <option value="C">C级-一般</option>
                                <option value="D">D级-较差</option>
                                <option value="unrated">未评级</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">检测状态</label>
                            <select id="filter-test-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                                <option value="">全部状态</option>
                                <option value="completed">已完成</option>
                                <option value="reviewed">已审核</option>
                                <option value="processing">检测中</option>
                                <option value="pending">待处理</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button id="refresh-reports" class="w-full px-3 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 text-sm">
                                <i class="fas fa-sync-alt mr-1"></i>刷新
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 报告列表区域 -->
                <div class="flex-1 flex flex-col min-h-0">
                    <div class="px-6 py-3 border-b border-gray-200 flex items-center justify-between flex-shrink-0">
                        <h4 class="text-md font-medium text-gray-900">可用报告</h4>
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-gray-500">共 <span id="reports-count">0</span> 条</span>
                            <span class="text-sm text-gray-500">第 <span id="current-page">1</span> 页，共 <span id="total-pages">1</span> 页</span>
                        </div>
                    </div>
                    
                    <!-- 表格容器 -->
                    <div class="flex-1 overflow-auto px-6">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50 sticky top-0">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">报告编号</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">宠物信息</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">主人</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">健康等级</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">检测日期</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                </tr>
                            </thead>
                            <tbody id="reports-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- 报告列表将动态填充 -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- 分页控件 -->
                    <div class="px-6 py-3 border-t border-gray-200 flex items-center justify-between flex-shrink-0">
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-gray-700">每页显示：</span>
                            <select id="page-size" class="border border-gray-300 rounded px-2 py-1 text-sm">
                                <option value="5">5条</option>
                                <option value="10" selected>10条</option>
                                <option value="20">20条</option>
                                <option value="50">50条</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button id="prev-page" class="px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fas fa-chevron-left mr-1"></i>上一页
                            </button>
                            <div id="page-numbers" class="flex space-x-1">
                                <!-- 页码按钮将动态生成 -->
                            </div>
                            <button id="next-page" class="px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                                下一页<i class="fas fa-chevron-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 测试结果区域 -->
            <div id="test-results-container" class="hidden border-t border-gray-200 bg-gray-50 max-h-64 overflow-y-auto flex-shrink-0">
                <div class="px-6 py-4">
                    <div id="test-results-content" class="space-y-3">
                        <!-- 测试结果内容 -->
                    </div>
                </div>
            </div>
            
            <!-- 模态框底部 -->
            <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-4 flex-shrink-0">
                <button id="cancel-test" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">
                    关闭
                </button>
            </div>
        </div>
    </div>

    <!-- 报告详情查看模态框 -->
    <div id="report-detail-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-5xl h-5/6 flex flex-col">
            <!-- 模态框头部 -->
            <div class="flex items-center justify-between px-6 py-4 border-b border-gray-200 flex-shrink-0">
                <h3 class="text-lg font-semibold text-gray-900">
                    <i class="fas fa-file-medical mr-2 text-blue-600"></i>报告详情
                </h3>
                <button id="close-report-detail" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- 模态框内容区域 -->
            <div class="flex-1 overflow-hidden flex flex-col">
                <!-- 报告基本信息 -->
                <div class="px-6 py-4 bg-blue-50 border-b border-blue-200 flex-shrink-0">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <span class="text-sm font-medium text-gray-600">报告编号：</span>
                            <span id="detail-report-number" class="text-sm text-gray-900"></span>
                        </div>
                        <div>
                            <span class="text-sm font-medium text-gray-600">宠物信息：</span>
                            <span id="detail-pet-info" class="text-sm text-gray-900"></span>
                        </div>
                        <div>
                            <span class="text-sm font-medium text-gray-600">主人：</span>
                            <span id="detail-owner-info" class="text-sm text-gray-900"></span>
                        </div>
                        <div>
                            <span class="text-sm font-medium text-gray-600">检测日期：</span>
                            <span id="detail-test-date" class="text-sm text-gray-900"></span>
                        </div>
                        <div>
                            <span class="text-sm font-medium text-gray-600">健康等级：</span>
                            <span id="detail-health-level" class="text-sm"></span>
                        </div>
                        <div>
                            <span class="text-sm font-medium text-gray-600">检测状态：</span>
                            <span id="detail-test-status" class="text-sm"></span>
                        </div>
                    </div>
                </div>
                
                <!-- 检测数据内容 -->
                <div class="flex-1 overflow-hidden flex flex-col">
                    <!-- 标签页导航 -->
                    <div class="px-6 py-3 border-b border-gray-200 flex-shrink-0">
                        <div class="flex space-x-4">
                            <button id="detail-tab-overview" class="detail-tab-btn px-4 py-2 text-sm font-medium text-blue-600 border-b-2 border-blue-600">
                                概览
                            </button>
                            <button id="detail-tab-phylum" class="detail-tab-btn px-4 py-2 text-sm font-medium text-gray-600 border-b-2 border-transparent hover:text-gray-900">
                                门指标
                            </button>
                            <button id="detail-tab-genus" class="detail-tab-btn px-4 py-2 text-sm font-medium text-gray-600 border-b-2 border-transparent hover:text-gray-900">
                                属指标
                            </button>
                        </div>
                    </div>
                    
                    <!-- 标签页内容 -->
                    <div class="flex-1 overflow-auto p-6">
                        <!-- 概览标签页 -->
                        <div id="detail-overview-content" class="detail-tab-content">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-white border rounded-lg p-4">
                                    <h4 class="font-medium text-gray-900 mb-3">
                                        <i class="fas fa-chart-pie mr-2 text-green-600"></i>关键指标
                                    </h4>
                                    <div id="detail-key-metrics" class="space-y-2">
                                        <!-- 关键指标将动态填充 -->
                                    </div>
                                </div>
                                <div class="bg-white border rounded-lg p-4">
                                    <h4 class="font-medium text-gray-900 mb-3">
                                        <i class="fas fa-info-circle mr-2 text-blue-600"></i>检测说明
                                    </h4>
                                    <div class="text-sm text-gray-600 space-y-2">
                                        <p>• 门指标：代表肠道菌群的主要分类群体</p>
                                        <p>• 属指标：代表具体的菌属种类和含量</p>
                                        <p>• 正常范围：基于大量健康宠物数据统计</p>
                                        <p>• 健康评级：综合各项指标的整体评估</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 门指标标签页 -->
                        <div id="detail-phylum-content" class="detail-tab-content hidden">
                            <div id="detail-phylum-data" class="space-y-4">
                                <!-- 门指标数据将动态填充 -->
                            </div>
                        </div>
                        
                        <!-- 属指标标签页 -->
                        <div id="detail-genus-content" class="detail-tab-content hidden">
                            <div id="detail-genus-data" class="space-y-4">
                                <!-- 属指标数据将动态填充 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 模态框底部 -->
            <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-4 flex-shrink-0">
                <button id="close-report-detail-btn" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">
                    关闭
                </button>
            </div>
        </div>
    </div>
</div>
